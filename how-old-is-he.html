<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Greg's Best of the Web 1.0 — How Old Is He?</title>

<!--<link rel="stylesheet" href="bestoftheweb.css">-->

  <style>
    body {
      margin:0;
      font-family: Verdana, Arial, sans-serif;
      background:url("pics/bg-star-01.gif") repeat #000000;
      color:#875fff;
    }
    a { color:#5fff00; }
    a:visited { color:#660099; }
    a:active { color:#ff0000; }

    .wrap-page {
      max-width:960px;
      margin:0 auto;
      padding:10px 8px 30px;
    }

    .center { text-align:center; }

    .card {
      margin-top:16px;
      background:rgba(0,0,0,0.8);
      border:2px solid #333366;
      border-radius:10px;
      padding:10px;
      display:flex;
      gap:12px;
    }

    .photo-box {
      flex:0 0 220px;
      max-width:220px;
    }
    .photo-box img {
      width:100%;
      height:300px;
      object-fit:cover;
      border:1px solid #444488;
    }

    .meta {
      flex:1;
      display:flex;
      flex-direction:column;
      gap:8px;
    }

    .name {
      font-size:24px;
      font-weight:bold;
    }
    .context {
      font-size:13px;
      color:#c0b0ff;
    }
    .age {
      font-size:18px;
      margin-top:2px;
    }
    .muted {
      color:#c0b0ff;
    }

    .pill-row {
      margin-top:6px;
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      font-size:11px;
    }
    .pill {
      padding:4px 8px;
      border-radius:999px;
      border:1px solid #444488;
      background:#000022;
    }

    .guess-block {
      margin-top:10px;
      padding:8px;
      border:1px dashed #444488;
      background:#000010;
    }
    .guess-label {
      font-size:12px;
      margin-bottom:6px;
      color:#c0b0ff;
    }
    .guess-controls {
      display:flex;
      gap:8px;
      align-items:stretch;
    }
    .guess-input {
      flex:1;
      padding:8px;
      font-size:18px;
      border:1px solid #444488;
      border-radius:4px;
      background:#000000;
      color:#ffffff;
      outline:none;
    }
    .guess-input:focus {
      border-color:#5fff00;
    }
    button {
      cursor:pointer;
      border:1px solid #444488;
      background:#000033;
      color:#ffffff;
      padding:8px 14px;
      font-size:14px;
      border-radius:4px;
    }
    button.primary {
      font-weight:bold;
      background:#111166;
    }

    .result {
      margin-top:8px;
      padding:6px 8px;
      border-radius:4px;
      border:1px solid #444488;
      background:#000022;
      font-size:13px;
    }
    .hidden { display:none; }

    .next-row {
      margin-top:8px;
      display:flex;
      gap:8px;
      align-items:center;
      font-size:12px;
      color:#c0b0ff;
      flex-wrap:wrap;
    }

    .small-note {
      font-size:11px;
      color:#c0b0ff;
    }

    .error {
      margin-top:12px;
      padding:8px;
      border-radius:4px;
      border:1px solid #884444;
      background:#220000;
      color:#ffaaaa;
      font-size:13px;
    }

    hr { border:0; border-top:1px solid #444488; margin:10px 0; }

    @media (max-width:700px) {
      .card {
        flex-direction:column;
      }
      .photo-box {
        flex:0 0 auto;
        max-width:none;
      }
      .photo-box img {
        height:auto;
      }
      .guess-controls {
        flex-direction:column;
      }
      button {
        width:100%;
      }
      .next-row {
        flex-direction:column;
        align-items:flex-start;
      }
    }
  </style>
</head>
<body background="pics/bg-star-01.gif" bgcolor="#000000" text="#875fff" link="#5fff00" vlink="#660099" alink="#ff0000">

  <div class="wrap-page">
    <div class="center">
    <div id="site-header"></div>
    <h2>How old is he?<h2></div>
	
    <div id="errorBox" class="error hidden"></div>

    <div class="card">
      <div class="photo-box">
        <img id="photo" alt="Celebrity photo">
      </div>

      <div class="meta">
        <div>
          <div class="name" id="name">Loading…</div>
          <div class="context" id="context"></div>
          <div class="age muted" id="age">(age hidden)</div>
        </div>

        <div class="pill-row">
          <div class="pill">Score: <strong id="score">0</strong></div>
          <div class="pill">Streak: <strong id="streak">0</strong></div>
          <div class="pill">Card <strong id="pos">0</strong>/<strong id="total">0</strong></div>
        </div>

        <div class="guess-block">
          <div class="guess-label">Guess his age in this photo:</div>
          <div class="guess-controls">
            <input
              type="number"
              id="guessInput"
              class="guess-input"
              placeholder="Type a number and press Enter"
              min="0"
              max="120"
              autocomplete="off"
            >
            <button id="submitGuess" class="primary">Guess age</button>
          </div>
        </div>

        <div class="pill-row">
          <button id="reveal">Reveal age</button>
        </div>

        <div id="feedback" class="result hidden"></div>

        <div id="nextRow" class="next-row hidden">
          <button id="nextNow" class="primary">Next person »</button>
          <button id="resetScore">Reset score</button>
          <span class="small-note" id="autoNote"></span>
        </div>
      </div>
    </div>
  </div>

<script>
let DATA = [];
let i = 0;
let score = 0;
let streak = 0;
let countdownTimer = null;
let countdownRemaining = 0;

const qs = new URLSearchParams(location.search);
const setName = qs.get("set") || "default";  // use ?set=week1 etc.
const dataUrl = `how-old-is-he-${setName}.json`;

const els = {
  photo: document.getElementById("photo"),
  name: document.getElementById("name"),
  context: document.getElementById("context"),
  age: document.getElementById("age"),
  score: document.getElementById("score"),
  streak: document.getElementById("streak"),
  pos: document.getElementById("pos"),
  total: document.getElementById("total"),
  reveal: document.getElementById("reveal"),
  feedback: document.getElementById("feedback"),
  guessInput: document.getElementById("guessInput"),
  submitGuess: document.getElementById("submitGuess"),
  nextRow: document.getElementById("nextRow"),
  nextNow: document.getElementById("nextNow"),
  resetScore: document.getElementById("resetScore"),
  autoNote: document.getElementById("autoNote"),
  errorBox: document.getElementById("errorBox"),
};

function scoreKey(name) {
  return `hoi_score_${name}`;
}
function streakKey(name) {
  return `hoi_streak_${name}`;
}

async function loadData() {
  try {
    const res = await fetch(dataUrl + "?v=" + Date.now());
    if (!res.ok) throw new Error(res.status + " " + res.statusText);
    const json = await res.json();
    if (!Array.isArray(json) || json.length === 0) throw new Error("No data");
    DATA = json;
    // clamp index
    i = parseInt(qs.get("i") || "0", 10);
    if (isNaN(i) || i < 0) i = 0;
    if (i >= DATA.length) i = DATA.length - 1;

    score = parseInt(localStorage.getItem(scoreKey(setName)) || "0", 10);
    streak = parseInt(localStorage.getItem(streakKey(setName)) || "0", 10);

    render();
  } catch (err) {
    els.errorBox.textContent =
      "Could not load data file: " + dataUrl + ". Check the filename and JSON format.";
    els.errorBox.classList.remove("hidden");
    console.error(err);
  }
}

function render() {
  const cur = DATA[i];
  els.total.textContent = DATA.length.toString();
  els.pos.textContent = (i + 1).toString();
  els.name.textContent = cur.name;
  els.context.textContent = cur.knownFor || "";
  els.age.textContent = "(age hidden)";
  els.age.classList.add("muted");
  els.feedback.classList.add("hidden");
  els.feedback.textContent = "";
  stopNextCountdown();
  els.nextRow.classList.add("hidden");
  els.autoNote.textContent = "";
  els.photo.alt = cur.name;
  if (cur.img) {
    els.photo.src = cur.img;
  } else {
    els.photo.removeAttribute("src");
  }
  els.score.textContent = score.toString();
  els.streak.textContent = streak.toString();
  els.guessInput.value = "";
  els.guessInput.focus();
}

function setIndex(newIndex) {
  const url = new URL(location.href);
  url.searchParams.set("i", String(newIndex));
  url.searchParams.set("set", setName);
  location.href = url.toString();
}

function saveScore() {
  localStorage.setItem(scoreKey(setName), String(score));
  localStorage.setItem(streakKey(setName), String(streak));
}

function startNextCountdown() {
  stopNextCountdown();
  els.nextRow.classList.remove("hidden");
  countdownRemaining = 5;
  els.autoNote.textContent =
    `Next card in ${countdownRemaining} seconds… or tap "Next person" now.`;
  countdownTimer = setInterval(() => {
    countdownRemaining--;
    if (countdownRemaining <= 0) {
      stopNextCountdown();
      setIndex((i + 1) % DATA.length);
    } else {
      els.autoNote.textContent =
        `Next card in ${countdownRemaining} seconds… or tap "Next person" now.`;
    }
  }, 1000);
}

function stopNextCountdown() {
  if (countdownTimer !== null) {
    clearInterval(countdownTimer);
    countdownTimer = null;
  }
}

function handleGuess() {
  const raw = els.guessInput.value.trim();
  if (!raw) return;
  const g = parseInt(raw, 10);
  if (isNaN(g)) return;

  const cur = DATA[i];
  const diff = Math.abs(g - cur.age);
  let pts = 0;
  if (diff === 0) pts = 3;
  else if (diff <= 2) pts = 2;
  else if (diff <= 5) pts = 1;

  score += pts;
  streak = pts > 0 ? streak + 1 : 0;
  saveScore();

  els.feedback.classList.remove("hidden");
  els.feedback.textContent = `You guessed ${g}. Actual: ${cur.age}. +${pts} point(s).`;
  els.score.textContent = score.toString();
  els.streak.textContent = streak.toString();

  els.age.textContent = "Age: " + cur.age;
  els.age.classList.remove("muted");

  startNextCountdown();
}

els.reveal.addEventListener("click", () => {
  if (!DATA.length) return;
  const cur = DATA[i];
  els.age.textContent = "Age: " + cur.age;
  els.age.classList.remove("muted");
  els.feedback.classList.add("hidden");
  els.feedback.textContent = "";
  startNextCountdown();
});

els.submitGuess.addEventListener("click", handleGuess);
els.guessInput.addEventListener("keydown", (e) => {
  if (e.key === "Enter") {
    e.preventDefault();
    handleGuess();
  }
});

els.nextNow.addEventListener("click", () => {
  stopNextCountdown();
  setIndex((i + 1) % DATA.length);
});

els.resetScore.addEventListener("click", () => {
  score = 0;
  streak = 0;
  saveScore();
  els.score.textContent = "0";
  els.streak.textContent = "0";
});

loadData();
</script>

    <div id="site-footer"></div>
  </div>

  <script src="includes.js"></script>
</body>
</html>
