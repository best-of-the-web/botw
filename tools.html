<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tools – Greg's Best of the Web 1.0</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="bestoftheweb.css">
</head>
<body>

<div class="wrap-page">

  <!-- Header include -->
  <div id="site-header" class="site-header"></div>

  <main>
    <h2 class="page-title">Tools</h2>

    <div class="layout">

      <!-- MAIN CONTENT -->
      <section class="main-content">

        <p class="center">
          Web tools, generators and utilities worth bookmarking.
        </p>

        <!-- Category tabs (optional; built from JSON categories) -->
        <div id="tools-tabs" class="tabs"></div>

        <!-- Simple unified grid -->
        <div class="thumb-grid" id="tools-gallery"></div>

      </section>

      <!-- SIDEBAR -->
      <aside id="site-sidebar" class="sidebar"></aside>

    </div>
  </main>

  <!-- Footer -->
  <div id="site-footer" class="site-footer"></div>

</div>

<script src="includes.js"></script>

<script>
  const TOOLS_JSON = "tools-gallery.json";

  let allTools = [];
  let filteredTools = [];
  let currentCat = "All";

  const tabsEl = document.getElementById("tools-tabs");
  const gridEl = document.getElementById("tools-gallery");

  async function loadTools() {
    try {
      const res = await fetch(TOOLS_JSON + "?v=" + Date.now());
      if (!res.ok) throw new Error(res.status + " " + res.statusText);
      const data = await res.json();
      if (!Array.isArray(data)) throw new Error("JSON is not an array");

      allTools = data;
      setupToolTabs();
      setToolCategory("All");
    } catch (err) {
      console.error("Failed to load tools JSON", err);
      gridEl.innerHTML = "<p class='center'><small>Could not load tools.</small></p>";
    }
  }

  function setupToolTabs() {
    const cats = new Set();
    allTools.forEach(t => { if (t.category) cats.add(t.category); });

    const categories = ["All", ...Array.from(cats).sort()];

    tabsEl.innerHTML = categories.map(cat => `
      <button class="tab" data-cat="${cat}">${cat}</button>
    `).join("");

    tabsEl.addEventListener("click", (e) => {
      const btn = e.target.closest(".tab");
      if (!btn) return;
      setToolCategory(btn.dataset.cat);
    });
  }

  function setToolCategory(cat) {
    currentCat = cat;
    filteredTools = (cat === "All")
      ? allTools.slice()
      : allTools.filter(t => t.category === cat);

    document.querySelectorAll(".tab").forEach(btn => {
      btn.classList.toggle("active", btn.dataset.cat === cat);
    });

    renderToolsGrid();
  }

  function renderToolsGrid() {
    gridEl.innerHTML = "";

    if (!filteredTools.length) {
      gridEl.innerHTML = "<p class='center'><small>No tools in this category.</small></p>";
      return;
    }

    filteredTools.forEach(tool => {
      const icon = tool.icon || "pics/tools/tool-default.png";
      const name = tool.name || tool.title || "Untitled tool";
      const desc = tool.desc || "";

      const card = document.createElement("div");
      card.className = "thumb-card";

      card.innerHTML = `
        <a href="${tool.url || '#'}" target="_blank" rel="noopener">
          <img src="${icon}" alt="${name}">
        </a>
        <small><strong>${name}</strong>${desc ? " – " + desc : ""}</small>
      `;

      gridEl.appendChild(card);
    });
  }

  document.addEventListener("DOMContentLoaded", loadTools);
</script>

</body>
</html>
