<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tools â€“ Greg's Best of the Web 1.0</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="bestoftheweb.css">

</head>
<body>

  <div class="wrap-page">

    <div id="site-header" class="site-header"></div>

    <main>
      <h2 class="page-title">Tools</h2>

      <div class="layout">
        <section class="main-content">

          <p class="center">
            Desktop and web tools worth actually installing. No bloat, no nags.
          </p>

          <!-- Category tabs -->
          <div id="tool-tabs" class="tabs"></div>

          <!-- Tools grid -->
          <div class="tools-grid" id="tool-gallery"></div>

        </section>

        <aside id="site-sidebar" class="sidebar"></aside>
      </div>
    </main>

    <div id="site-footer" class="site-footer"></div>
  </div>

  <script src="includes.js"></script>

  <script>
    const TOOLS_JSON = "tools-gallery.json";

    let allTools = [];
    let filteredTools = [];
    let currentCategory = "All";

    const tTabsEl = document.getElementById("tool-tabs");
    const tGalleryEl = document.getElementById("tool-gallery");

    async function loadTools() {
      try {
        const res = await fetch(TOOLS_JSON + "?v=" + Date.now());
        if (!res.ok) throw new Error(res.status + " " + res.statusText);
        const data = await res.json();
        if (!Array.isArray(data)) throw new Error("JSON is not an array");

        allTools = data;
        setupToolCategories();
        setToolCategory("All");
      } catch (err) {
        console.error("Failed to load tools JSON", err);
        tGalleryEl.innerHTML = "<p class='center'><small>Could not load tools.</small></p>";
      }
    }

    function setupToolCategories() {
      const cats = new Set();
      allTools.forEach(t => {
        if (t.category) cats.add(t.category);
      });

      const categories = ["All", ...Array.from(cats).sort()];
      tTabsEl.innerHTML = categories.map(cat => `
        <button class="tab" data-cat="${cat}">${cat}</button>
      `).join("");

      tTabsEl.addEventListener("click", e => {
        const btn = e.target.closest(".tab");
        if (!btn) return;
        setToolCategory(btn.dataset.cat);
      });
    }

    function setToolCategory(cat) {
      currentCategory = cat;

      filteredTools =
        cat === "All" ? allTools.slice() : allTools.filter(t => t.category === cat);

      document.querySelectorAll("#tool-tabs .tab").forEach(btn => {
        btn.classList.toggle("active", btn.dataset.cat === cat);
      });

      renderToolGallery();
    }

    function renderToolGallery() {
      tGalleryEl.innerHTML = "";

      if (!filteredTools.length) {
        tGalleryEl.innerHTML = "<p class='center'><small>No tools found.</small></p>";
        return;
      }

      filteredTools.forEach(tool => {
        const div = document.createElement("div");
        div.className = "tool-card-pixel";

        const iconSrc = tool.icon || "pics/tools/tool-default.png";
        const name = tool.name || "Unnamed tool";

        div.innerHTML = `
          <img src="${iconSrc}" alt="">
          <a class="tool-name" href="${tool.url}" target="_blank" rel="noopener">
            ${name}
          </a>
          <div class="tool-tags">
            ${tool.platform ? `<span class="tool-tag">${tool.platform}</span>` : ""}
            ${tool.label ? `<span class="tool-tag tool-tag-accent">${tool.label}</span>` : ""}
            ${tool.category ? `<span class="tool-tag">${tool.category}</span>` : ""}
          </div>
          <p class="tool-desc">${tool.description || ""}</p>
        `;

        tGalleryEl.appendChild(div);
      });
    }

    document.addEventListener("DOMContentLoaded", loadTools);
  </script>

</body>
</html>
