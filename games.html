<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Games – Greg's Best of the Web 1.0</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="bestoftheweb.css">
</head>
<body>

<div class="wrap-page">

  <!-- Header -->
  <div id="site-header" class="site-header"></div>

  <main>
    <h2 class="page-title">Games</h2>

    <div class="layout">

      <!-- MAIN CONTENT -->
      <section class="main-content">

        <p class="center">
          Quick, no-faff games – some hosted here, some out on the wider web.
        </p>

        <div id="games-tabs" class="tabs"></div>

        <div class="thumb-grid" id="games-gallery"></div>

      </section>

      <!-- SIDEBAR -->
      <aside id="site-sidebar" class="sidebar"></aside>

    </div>
  </main>

  <div id="site-footer" class="site-footer"></div>

</div>

<script src="includes.js"></script>

<script>
  const GAMES_JSON = "games-gallery.json";

  let allGames = [];
  let filteredGames = [];
  let currentGameCat = "All";

  const gameTabsEl = document.getElementById("games-tabs");
  const gameGridEl = document.getElementById("games-gallery");

  async function loadGames() {
    try {
      const res = await fetch(GAMES_JSON + "?v=" + Date.now());
      if (!res.ok) throw new Error(res.status + " " + res.statusText);
      const data = await res.json();
      if (!Array.isArray(data)) throw new Error("JSON is not an array");

      allGames = data;
      setupGameTabs();
      setGameCategory("All");
    } catch (err) {
      console.error("Failed to load games JSON", err);
      gameGridEl.innerHTML = "<p class='center'><small>Could not load games.</small></p>";
    }
  }

  function setupGameTabs() {
    const cats = new Set();
    allGames.forEach(g => { if (g.category) cats.add(g.category); });

    const categories = ["All", ...Array.from(cats).sort()];

    gameTabsEl.innerHTML = categories.map(cat => `
      <button class="tab" data-cat="${cat}">${cat}</button>
    `).join("");

    gameTabsEl.addEventListener("click", (e) => {
      const btn = e.target.closest(".tab");
      if (!btn) return;
      setGameCategory(btn.dataset.cat);
    });
  }

  function setGameCategory(cat) {
    currentGameCat = cat;
    filteredGames = (cat === "All")
      ? allGames.slice()
      : allGames.filter(g => g.category === cat);

    document.querySelectorAll(".tab").forEach(btn => {
      btn.classList.toggle("active", btn.dataset.cat === cat);
    });

    renderGamesGrid();
  }

  function renderGamesGrid() {
    gameGridEl.innerHTML = "";

    if (!filteredGames.length) {
      gameGridEl.innerHTML = "<p class='center'><small>No games in this category.</small></p>";
      return;
    }

    filteredGames.forEach(game => {
      const icon = game.icon || "pics/games/game-default.png";
      const name = game.name || game.title || "Untitled game";
      const desc = game.desc || "";

      const card = document.createElement("div");
      card.className = "thumb-card";

      // If it's an internal game page, url can just be "how-old-is-he.html" etc.
      card.innerHTML = `
        <a href="${game.url || '#'}" target="_blank" rel="noopener">
          <img src="${icon}" alt="${name}">
        </a>
        <small><strong>${name}</strong>${desc ? " – " + desc : ""}</small>
      `;

      gameGridEl.appendChild(card);
    });
  }

  document.addEventListener("DOMContentLoaded", loadGames);
</script>

</body>
</html>
